package io.cryptotax

import android.os.Bundle
import androidx.appcompat.app.AppCompatActivity
import kotlinx.android.synthetic.main.activity_main.add
import kotlinx.android.synthetic.main.activity_main.calculate
import kotlinx.android.synthetic.main.activity_main.fee
import kotlinx.android.synthetic.main.activity_main.from
import kotlinx.android.synthetic.main.activity_main.fromQuantity
import kotlinx.android.synthetic.main.activity_main.fromValue
import kotlinx.android.synthetic.main.activity_main.gainz
import kotlinx.android.synthetic.main.activity_main.result
import kotlinx.android.synthetic.main.activity_main.to
import kotlinx.android.synthetic.main.activity_main.toQuantity
import kotlinx.android.synthetic.main.activity_main.toValue
import java.math.BigDecimal

class MainActivity : AppCompatActivity() {

  val transactions = mutableListOf<Transaction>()

  override fun onCreate(savedInstanceState: Bundle?) {
    super.onCreate(savedInstanceState)
    setContentView(R.layout.activity_main)

    transactions.addAll(
        Utils.toObject(
            """
[{"transactionType":"BUY","date":"31.01.2021-17:40:00","fee":5,"from":"EUR","fromQuantity":245,"fromValue":245,"to":"DOGE","toQuantity":9131.6,"toValue":245},{"transactionType":"BUY","date":"01.02.2021-03:26:00","fee":4,"from":"EUR","fromQuantity":196,"fromValue":196,"to":"DOGE","toQuantity":6227.1,"toValue":196},{"transactionType":"BUY","date":"01.02.2021-18:34:31","fee":5.4,"from":"EUR","fromQuantity":294.6,"fromValue":294.6,"to":"DOGE","toQuantity":8992.6,"toValue":294.6},{"transactionType":"BUY","date":"02.02.2021-12:53:30","fee":9.03,"from":"EUR","fromQuantity":490.97,"fromValue":490.97,"to":"ADA","toQuantity":1411.9,"toValue":490.97},{"transactionType":"TRADE","date":"02.02.2021-13:52:21","fee":0.1,"from":"DOGE","fromQuantity":4000,"fromValue":102.88,"to":"BTC","toQuantity":0.00375624,"toValue":102.78},{"transactionType":"TRADE","date":"02.02.2021-14:56:06","fee":0.11,"from":"BTC","fromQuantity":0.0037504,"fromValue":102.62,"to":"ADA","toQuantity":292.707,"toValue":102.51},{"transactionType":"BUY","date":"02.02.2021-18:16:30","fee":0.11,"from":"EUR","fromQuantity":196.2,"fromValue":196.2,"to":"ADA","toQuantity":539.9,"toValue":196.2},{"transactionType":"TRANSFER","date":"02.02.2021-19:21:53","fee":0.11,"from":"ADA","fromQuantity":539.9,"fromValue":177.51,"to":"WALLET","toQuantity":0,"toValue":0},{"transactionType":"BUY","date":"03.02.2021-3:28:03","fee":3.57,"from":"EUR","fromQuantity":196.43,"fromValue":196.43,"to":"BTC","toQuantity":0.006541,"toValue":196.43},{"transactionType":"TRADE","date":"03.02.2021-4:30:57","fee":0.19,"from":"BTC","fromQuantity":0.00654717,"fromValue":190.3,"to":"STMX","toQuantity":31145.823,"toValue":190.11},{"transactionType":"TRADE","date":"03.02.2021-11:10:08","fee":0.2,"from":"STMX","fromQuantity":31145,"fromValue":199.15,"to":"BTC","toQuantity":0.00684505,"toValue":198.95},{"transactionType":"TRADE","date":"03.02.2021-11:30:35","fee":0.19,"from":"BTC","fromQuantity":0.00684504,"fromValue":198.95,"to":"STMX","toQuantity":28492.479,"toValue":198.76},{"transactionType":"TRADE","date":"03.02.2021-13:36:58","fee":0.28,"from":"STMX","fromQuantity":28493,"fromValue":281.57,"to":"BTC","toQuantity":0.00967793,"toValue":281.29},{"transactionType":"TRADE","date":"03.02.2021-13:40:30","fee":0.28,"from":"BTC","fromQuantity":0.00967785,"fromValue":281.29,"to":"STMX","toQuantity":24790.185,"toValue":281.01},{"transactionType":"TRADE","date":"03.02.2021-18:03:01","fee":0.2,"from":"STMX","fromQuantity":24790,"fromValue":208.95,"to":"BTC","toQuantity":0.00718191,"toValue":208.75},{"transactionType":"TRADE","date":"03.02.2021-18:48:44","fee":0.03,"from":"BTC","fromQuantity":0.00083498,"fromValue":24.27,"to":"DOT","toQuantity":1.5984,"toValue":24.24},{"transactionType":"TRADE","date":"03.02.2021-18:48:44","fee":0.15,"from":"BTC","fromQuantity":0.00547953,"fromValue":159.26,"to":"DOT","toQuantity":10.4895,"toValue":159.11},{"transactionType":"TRADE","date":"03.02.2021-18:48:58","fee":0.03,"from":"BTC","fromQuantity":0.00083498,"fromValue":24.27,"to":"DOT","toQuantity":1.5984,"toValue":24.24},{"transactionType":"BUY","date":"03.02.2021-13:26:55","fee":9,"from":"EUR","fromQuantity":491,"fromValue":491,"to":"BTC","toQuantity":0.015538,"toValue":491},{"transactionType":"TRADE","date":"04.02.2021-1:36:55","fee":0.26,"from":"BTC","fromQuantity":0.008296,"fromValue":254.78,"to":"LTC","toQuantity":1.998,"toValue":254.52},{"transactionType":"TRADE","date":"04.02.2021-1:43:50","fee":0.26,"from":"BTC","fromQuantity":0.00335821,"fromValue":103.13,"to":"ETH","toQuantity":0.075924,"toValue":103.03},{"transactionType":"TRADE","date":"04.02.2021-1:43:50","fee":0.12,"from":"BTC","fromQuantity":0.00384427,"fromValue":118.06,"to":"ETH","toQuantity":0.086913,"toValue":117.94},{"transactionType":"SELL","date":"04.02.2021-1:43:50","fee":0,"from":"DOGE","fromQuantity":20351.2,"fromValue":867.164632,"to":"EUR","toQuantity":867.164632,"toValue":867.164632},{"transactionType":"BUY_FROM_DEPOSIT","date":"04.02.2021-11:08:30","fee":0,"from":"EUR","fromQuantity":867.16364,"fromValue":867.16364,"to":"DOGE","toQuantity":19574.8,"toValue":867.16364},{"transactionType":"DEPOSIT","date":"04.02.2021-11:11:32","fee":3.6,"from":"EUR","fromQuantity":196.4,"fromValue":196.4,"to":"EUR","toQuantity":196.4,"toValue":196.4},{"transactionType":"BUY_FROM_DEPOSIT","date":"04.02.2021 11:33:17","fee":0,"from":"EUR","fromQuantity":196.38829936,"fromValue":196.38829936,"to":"BTC","toQuantity":0.006224,"toValue":196.38829936},{"transactionType":"TRADE","date":"2021-02-04T10:59:45.000Z","fee":0.029999999999997584,"from":"BTC","fromQuantity":0.00091368,"fromValue":28.06,"to":"WABI","toQuantity":215.784,"toValue":28.03},{"transactionType":"TRADE","date":"2021-02-04T12:22:01.000Z","fee":0.1599999999999966,"from":"BTC","fromQuantity":0.00525662,"fromValue":161.43,"to":"UNI","toQuantity":9.6903,"toValue":161.27},{"transactionType":"SELL","date":"2021-02-04T23:02:10.000Z","fee":0,"from":"DOGE","fromQuantity":1125.7,"fromValue":47.31,"to":"EUR","toQuantity":47.31,"toValue":47.31},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-04T23:19:55.000Z","fee":0,"from":"EUR","fromQuantity":47.322,"fromValue":47.322,"to":"DOGE","toQuantity":1085.5,"toValue":47.322},{"transactionType":"SELL","date":"2021-02-04T23:30:36.000Z","fee":0,"from":"DOGE","fromQuantity":11.4,"fromValue":0.48,"to":"EUR","toQuantity":0.48,"toValue":0.48},{"transactionType":"SELL","date":"2021-02-05T23:30:36.000Z","fee":0,"from":"DOGE","fromQuantity":343.6,"fromValue":14.45,"to":"EUR","toQuantity":14.45,"toValue":14.45},{"transactionType":"SELL","date":"2021-02-06T23:30:36.000Z","fee":0,"from":"DOGE","fromQuantity":3740.7,"fromValue":157.33,"to":"EUR","toQuantity":157.33,"toValue":157.33},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-04T23:35:00.000Z","fee":0,"from":"EUR","fromQuantity":19.155024,"fromValue":19.155024,"to":"DOGE","toQuantity":446.4,"toValue":19.155024},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-05T23:35:01.000Z","fee":0,"from":"EUR","fromQuantity":152.935531,"fromValue":152.935531,"to":"DOGE","toQuantity":3564.1,"toValue":152.935531},{"transactionType":"SELL","date":"2021-02-04T23:41:28.000Z","fee":0,"from":"DOGE","fromQuantity":4862.4,"fromValue":206.214384,"to":"EUR","toQuantity":206.214384,"toValue":206.214384},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-04T23:46:00.000Z","fee":0,"from":"EUR","fromQuantity":206.212434,"fromValue":206.212434,"to":"DOGE","toQuantity":4815.4797,"toValue":206.212434},{"transactionType":"SELL","date":"2021-02-05T01:18:11.000Z","fee":0,"from":"DOGE","fromQuantity":5238,"fromValue":213.02946,"to":"EUR","toQuantity":213.02946,"toValue":213.02946},{"transactionType":"SELL","date":"2021-02-05T01:18:13.000Z","fee":0,"from":"DOGE","fromQuantity":0.7,"fromValue":0.028469,"to":"EUR","toQuantity":0.028469,"toValue":0.028469},{"transactionType":"SELL","date":"2021-02-05T01:21:27.000Z","fee":0,"from":"DOGE","fromQuantity":1512.8,"fromValue":59.45403845,"to":"EUR","toQuantity":59.45403845,"toValue":59.45403845},{"transactionType":"SELL","date":"2021-02-06T01:21:27.000Z","fee":0,"from":"DOGE","fromQuantity":4495.3,"fromValue":176.12936033,"to":"EUR","toQuantity":176.12936033,"toValue":176.12936033},{"transactionType":"SELL","date":"2021-02-07T01:21:27.000Z","fee":0,"from":"DOGE","fromQuantity":1073.8,"fromValue":42.24395776,"to":"EUR","toQuantity":42.24395776,"toValue":42.24395776},{"transactionType":"SELL","date":"2021-02-05T01:21:52.000Z","fee":0,"from":"DOGE","fromQuantity":5767,"fromValue":224.86092399,"to":"EUR","toQuantity":224.86092399,"toValue":224.86092399},{"transactionType":"SELL","date":"2021-02-06T01:21:52.000Z","fee":0,"from":"DOGE","fromQuantity":1314.9,"fromValue":51.19041135,"to":"EUR","toQuantity":51.19041135,"toValue":51.19041135},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-05T01:49:32.000Z","fee":0,"from":"EUR","fromQuantity":160.31197,"fromValue":160.31197,"to":"DOGE","toQuantity":4049.3466,"toValue":160.31197},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-06T01:49:32.000Z","fee":0,"from":"EUR","fromQuantity":606.62581,"fromValue":606.62581,"to":"DOGE","toQuantity":15322.8618,"toValue":606.62581},{"transactionType":"SELL","date":"2021-02-05T01:56:40.000Z","fee":0,"from":"DOGE","fromQuantity":2105.1,"fromValue":81.446319,"to":"EUR","toQuantity":81.446319,"toValue":81.446319},{"transactionType":"SELL","date":"2021-02-05T01:56:40.000Z","fee":0,"from":"DOGE","fromQuantity":17267.1,"fromValue":668.064099,"to":"EUR","toQuantity":668.064099,"toValue":668.064099},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-06T01:49:32.000Z","fee":0,"from":"EUR","fromQuantity":6.908,"fromValue":6.908,"to":"DOGE","toQuantity":172.5273,"toValue":6.908},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-06T01:49:32.000Z","fee":0,"from":"EUR","fromQuantity":742.604,"fromValue":742.604,"to":"DOGE","toQuantity":18565.1,"toValue":742.604},{"transactionType":"TRANSFER","date":"2021-02-05T20:31:32.000Z","fee":0.36,"from":"ADA","fromQuantity":1704.6156,"fromValue":616.56,"to":"WALLET","toQuantity":0,"toValue":0},{"transactionType":"BUY","date":"2021-02-06T22:13:22.000Z","fee":0,"from":"EUR","fromQuantity":980,"fromValue":980,"to":"BTC","toQuantity":0.029706,"toValue":980},{"transactionType":"TRADE","date":"2021-02-06T22:14:42.000Z","fee":0,"from":"BTC","fromQuantity":0.02975442,"fromValue":981.6,"to":"ADA","toQuantity":1882,"toValue":925.36},{"transactionType":"TRANSFER","date":"2021-02-06T22:19:00.000Z","fee":0.44,"from":"ADA","fromQuantity":1879.118,"fromValue":828.9,"to":"WALLET","toQuantity":0,"toValue":0},{"transactionType":"DEPOSIT","date":"2021-02-08T08:40:16.000Z","fee":0,"from":"EUR","fromQuantity":300,"fromValue":300,"to":"EUR","toQuantity":300,"toValue":300},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-08T23:18:20.000Z","fee":0.028308099999996728,"from":"EUR","fromQuantity":33.6683081,"fromValue":33.6683081,"to":"BNB","toQuantity":0.51061675,"toValue":33.64},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-09T23:18:20.000Z","fee":0.19999999999998863,"from":"EUR","fromQuantity":266.28,"fromValue":266.28,"to":"BNB","toQuantity":4.03796925,"toValue":266.08},{"transactionType":"TRADE","date":"2021-02-08T23:20:50.000Z","fee":0.30000000000001137,"from":"BNB","fromQuantity":4.548576,"fromValue":296.18,"to":"BTT","toQuantity":284001.714,"toValue":295.88},{"transactionType":"TRADE","date":"2021-02-08T23:26:59.000Z","fee":0.19999999999998863,"from":"BTT","fromQuantity":270567,"fromValue":267.44,"to":"BNB","toQuantity":4.10412666,"toValue":267.24},{"transactionType":"TRADE","date":"2021-02-08T23:26:59.000Z","fee":0.009999999999999787,"from":"BTT","fromQuantity":13434,"fromValue":13.26,"to":"BNB","toQuantity":0.2035067,"toValue":13.25},{"transactionType":"TRADE","date":"2021-02-09T01:52:44.000Z","fee":0.28000000000002956,"from":"BNB","fromQuantity":4.30763454,"fromValue":280.49,"to":"BTT","toQuantity":262878.858,"toValue":280.21},{"transactionType":"TRADE","date":"2021-02-09T02:59:18.000Z","fee":0.09999999999999432,"from":"BTT","fromQuantity":137552,"fromValue":141.6,"to":"BNB","toQuantity":2.1730661,"toValue":141.5},{"transactionType":"TRADE","date":"2021-02-09T02:59:19.000Z","fee":0.0799999999999983,"from":"BTT","fromQuantity":95028,"fromValue":97.83,"to":"BNB","toQuantity":1.50126589,"toValue":97.75},{"transactionType":"TRADE","date":"2021-02-09T02:59:19.000Z","fee":0.019999999999999574,"from":"BTT","fromQuantity":30299,"fromValue":31.19,"to":"BNB","toQuantity":0.47866792,"toValue":31.17},{"transactionType":"TRADE","date":"2021-02-09T03:05:32.000Z","fee":0.27000000000003865,"from":"BNB","fromQuantity":4.152994,"fromValue":270.42,"to":"BTT","toQuantity":259140.6,"toValue":270.15},{"transactionType":"TRADE","date":"2021-02-09T03:21:28.000Z","fee":0.04999999999999716,"from":"BTT","fromQuantity":63089,"fromValue":63.47,"to":"BNB","toQuantity":0.97399401,"toValue":63.42},{"transactionType":"TRADE","date":"2021-02-09T03:21:28.000Z","fee":0.019999999999999574,"from":"BTT","fromQuantity":27000,"fromValue":27.11,"to":"BNB","toQuantity":0.41602775,"toValue":27.09},{"transactionType":"TRADE","date":"2021-02-09T03:21:28.000Z","fee":0.030000000000001137,"from":"BTT","fromQuantity":39561,"fromValue":39.7,"to":"BNB","toQuantity":0.60917778,"toValue":39.67},{"transactionType":"TRADE","date":"2021-02-09T03:21:28.000Z","fee":0.09000000000000341,"from":"BTT","fromQuantity":129491,"fromValue":130.35,"to":"BNB","toQuantity":2.00042942,"toValue":130.26},{"transactionType":"TRADE","date":"2021-02-09T03:32:03.000Z","fee":0.20000000000004547,"from":"BNB","fromQuantity":3.99299646,"fromValue":270.29,"to":"BTC","toQuantity":0.00712095,"toValue":270.09},{"transactionType":"DEPOSIT","date":"2021-02-11T08:12:17.000Z","fee":0,"from":"EUR","fromQuantity":1000,"fromValue":1000,"to":"EUR","toQuantity":1000,"toValue":1000},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-11T10:05:54.000Z","fee":0.48,"from":"EUR","fromQuantity":627.9614,"fromValue":627.9614,"to":"ADA","toQuantity":830,"toValue":627.96},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-11T10:05:54.000Z","fee":0.3760440000000358,"from":"EUR","fromQuantity":372.086044,"fromValue":372.086044,"to":"ADA","toQuantity":491.3082,"toValue":371.71},{"transactionType":"TRANSFER","date":"2021-02-11T10:22:27.000Z","fee":0.76,"from":"ADA","fromQuantity":1320.3482,"fromValue":999.25,"to":"WALLET","toQuantity":0,"toValue":0},{"transactionType":"TRADE","date":"2021-02-11T11:35:12.000Z","fee":0.2599999999999909,"from":"BTC","fromQuantity":0.00712372,"fromValue":261.68,"to":"ATOM","toQuantity":19.94004,"toValue":261.42},{"transactionType":"TRADE","date":"2021-02-12T07:55:41.000Z","fee":0.13,"from":"UNI","fromQuantity":9.6,"fromValue":181.48,"to":"BTC","toQuantity":0.00463382,"toValue":181.48},{"transactionType":"TRADE","date":"2021-02-12T08:06:59.000Z","fee":0.13,"from":"BTC","fromQuantity":0.0045982,"fromValue":180.09,"to":"GRT","toQuantity":83,"toValue":180.09},{"transactionType":"BUY","date":"2021-02-12T09:21:22.000Z","fee":0,"from":"EUR","fromQuantity":200.89,"fromValue":200.89,"to":"BTC","toQuantity":0.005087,"toValue":200.89},{"transactionType":"TRANSFER","date":"2021-02-12T09:23:17.000Z","fee":0,"from":"BTC","fromQuantity":0.004587,"fromValue":181.14,"to":"WALLET","toQuantity":0,"toValue":0},{"transactionType":"TRADE","date":"2021-02-12T09:25:55.000Z","fee":0.009999999999999787,"from":"BNB","fromQuantity":0.11254,"fromValue":11.41,"to":"ATOM","toQuantity":0.67932,"toValue":11.4},{"transactionType":"TRADE","date":"2021-02-13T09:25:55.000Z","fee":0.030000000000001137,"from":"BNB","fromQuantity":0.23832,"fromValue":24.17,"to":"ATOM","toQuantity":1.43856,"toValue":24.14},{"transactionType":"TRADE","date":"2021-02-14T09:25:55.000Z","fee":0.01,"from":"BTC","fromQuantity":0.00049883,"fromValue":19.54,"to":"ATOM","toQuantity":1.11,"toValue":19.54},{"transactionType":"TRADE","date":"2021-02-12T12:42:06.000Z","fee":0,"from":"GRT","fromQuantity":9,"fromValue":19.85,"to":"BTC","toQuantity":0.00050679,"toValue":19.85},{"transactionType":"TRADE","date":"2021-02-12T12:42:06.000Z","fee":0,"from":"GRT","fromQuantity":20,"fromValue":44.11,"to":"BTC","toQuantity":0.0011262,"toValue":44.11},{"transactionType":"TRADE","date":"2021-02-12T12:42:06.000Z","fee":0,"from":"GRT","fromQuantity":22,"fromValue":48.46,"to":"BTC","toQuantity":0.00123728,"toValue":48.46},{"transactionType":"TRADE","date":"2021-02-12T12:42:06.000Z","fee":0.05000000000000426,"from":"GRT","fromQuantity":22,"fromValue":48.46,"to":"BTC","toQuantity":0.00123604,"toValue":48.41},{"transactionType":"TRADE","date":"2021-02-12T12:42:06.000Z","fee":0,"from":"GRT","fromQuantity":2,"fromValue":4.4,"to":"BTC","toQuantity":0.00011233,"toValue":4.4},{"transactionType":"TRADE","date":"2021-02-12T12:42:06.000Z","fee":0.010000000000001563,"from":"GRT","fromQuantity":6,"fromValue":13.21,"to":"BTC","toQuantity":0.00033698,"toValue":13.2},{"transactionType":"TRADE","date":"2021-02-12T12:42:06.000Z","fee":0,"from":"GRT","fromQuantity":2,"fromValue":4.4,"to":"BTC","toQuantity":0.00011231,"toValue":4.4},{"transactionType":"TRADE","date":"2021-02-12T22:23:48.000Z","fee":0.18000000000000682,"from":"BTC","fromQuantity":0.00466807,"fromValue":182.82,"to":"ATOM","toQuantity":10.57941,"toValue":182.64},{"transactionType":"DEPOSIT","date":"2/13/2021 08:48:02","fee":0,"from":"WALLET","fromQuantity":0,"fromValue":0,"to":"XLM","toQuantity":355.2912739,"toValue":153.11},{"transactionType":"TRADE","date":"2021-02-14T17:20:53.000Z","fee":0.8800000000001091,"from":"DOGE","fromQuantity":18737,"fromValue":871.69,"to":"BTC","toQuantity":0.0226491,"toValue":870.81},{"transactionType":"TRADE","date":"2021-02-14T23:08:38.000Z","fee":0.8999999999999773,"from":"BTC","fromQuantity":0.02264982,"fromValue":901.76,"to":"DOGE","toQuantity":17540.442,"toValue":900.86},{"transactionType":"TRADE","date":"2021-02-15T00:41:01.000Z","fee":0.8299999999999272,"from":"DOGE","fromQuantity":17541,"fromValue":831.05,"to":"BTC","toQuantity":0.02085292,"toValue":830.22},{"transactionType":"TRADE","date":"2021-02-15T07:31:53.000Z","fee":0.13,"from":"BTC","fromQuantity":0.00441202,"fromValue":175.66,"to":"DOGE","toQuantity":3739,"toValue":175.66},{"transactionType":"TRADE","date":"2021-02-15T07:31:53.000Z","fee":0,"from":"BTC","fromQuantity":0.0001062,"fromValue":4.23,"to":"DOGE","toQuantity":90,"toValue":4.23},{"transactionType":"TRADE","date":"2021-02-15T07:31:53.000Z","fee":0.03,"from":"BTC","fromQuantity":0.00088854,"fromValue":35.38,"to":"DOGE","toQuantity":753,"toValue":35.38},{"transactionType":"TRADE","date":"2021-02-15T07:31:53.000Z","fee":0.57000000000005,"from":"BTC","fromQuantity":0.01426502,"fromValue":567.94,"to":"DOGE","toQuantity":12076.911,"toValue":567.37},{"transactionType":"TRADE","date":"2021-02-15T07:31:53.000Z","fee":0.04,"from":"BTC","fromQuantity":0.00118,"fromValue":46.98,"to":"DOGE","toQuantity":1000,"toValue":46.98},{"transactionType":"TRADE","date":"2021-02-15T07:31:53.000Z","fee":0.82000000000005,"from":"DOGE","fromQuantity":17659,"fromValue":822.58,"to":"BTC","toQuantity":0.02064037,"toValue":821.76},{"transactionType":"DEPOSIT","date":"2021-02-15T08:35:27.000Z","fee":0,"from":"EUR","fromQuantity":1000,"fromValue":1000,"to":"EUR","toQuantity":1000,"toValue":1000},{"transactionType":"TRADE","date":"2021-02-15T07:31:53.000Z","fee":0.8300000000000409,"from":"BTC","fromQuantity":0.0206398,"fromValue":821.74,"to":"DOGE","toQuantity":16628.355,"toValue":820.91},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-15T12:20:05.000Z","fee":0,"from":"EUR","fromQuantity":10.233375,"fromValue":10.233375,"to":"DOT","toQuantity":0.435,"toValue":10.233375},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-15T12:20:05.000Z","fee":0,"from":"EUR","fromQuantity":11.738975,"fromValue":11.738975,"to":"DOT","toQuantity":0.499,"toValue":11.738975},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-15T12:20:05.000Z","fee":0,"from":"EUR","fromQuantity":82.29045,"fromValue":82.29,"to":"DOT","toQuantity":3.498,"toValue":82.29},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-15T12:20:07.000Z","fee":0,"from":"EUR","fromQuantity":395.6905,"fromValue":395.6905,"to":"DOT","toQuantity":16.82,"toValue":395.6905},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-15T12:20:10.000Z","fee":0,"from":"EUR","fromQuantity":0.0941,"fromValue":0.0941,"to":"DOT","toQuantity":0.004,"toValue":0.0941},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-15T12:20:10.000Z","fee":0,"from":"EUR","fromQuantity":499.933096,"fromValue":499.933096,"to":"ADA","toQuantity":696.8,"toValue":499.933096},{"transactionType":"TRADE","date":"2021-02-15T07:31:53.000Z","fee":0.8099999999999454,"from":"DOGE","fromQuantity":16628,"fromValue":807.66,"to":"BTC","toQuantity":0.02026587,"toValue":806.85},{"transactionType":"TRANSFER","date":"2021-02-16T11:44:09.000Z","fee":0.7,"from":"ADA","fromQuantity":695.8,"fromValue":490.16,"to":"WALLET","toQuantity":0,"toValue":0},{"transactionType":"TRADE","date":"2021-02-16T13:01:42.000Z","fee":0.02,"from":"BTC","fromQuantity":0.00050624,"fromValue":19.86,"to":"DOGE","toQuantity":448,"toValue":19.86},{"transactionType":"TRADE","date":"2021-02-16T13:01:47.000Z","fee":0.2,"from":"BTC","fromQuantity":0.00678,"fromValue":265.99,"to":"DOGE","toQuantity":6000,"toValue":265.99},{"transactionType":"TRADE","date":"2021-02-16T13:01:52.000Z","fee":0.02,"from":"BTC","fromQuantity":0.00072546,"fromValue":28.46,"to":"DOGE","toQuantity":642,"toValue":28.46},{"transactionType":"TRADE","date":"2021-02-16T13:01:53.000Z","fee":0.2599999999999909,"from":"BTC","fromQuantity":0.00678,"fromValue":265.99,"to":"DOGE","toQuantity":5994,"toValue":265.73},{"transactionType":"TRADE","date":"2021-02-16T13:01:57.000Z","fee":0.01,"from":"BTC","fromQuantity":0.00043279,"fromValue":16.98,"to":"DOGE","toQuantity":383,"toValue":16.98},{"transactionType":"TRADE","date":"2021-02-16T13:01:58.000Z","fee":0.20000000000001705,"from":"BTC","fromQuantity":0.00504093,"fromValue":197.77,"to":"DOGE","toQuantity":4456.539,"toValue":197.57},{"transactionType":"DEPOSIT","date":"2021-02-18T06:14:24.000Z","fee":0,"from":"EUR","fromQuantity":1000,"fromValue":1000,"to":"EUR","toQuantity":1000,"toValue":1000},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-18T07:46:17.000Z","fee":0,"from":"EUR","fromQuantity":429.978531,"fromValue":429.98,"to":"DOT","toQuantity":16.380603,"toValue":429.98},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-18T07:46:17.000Z","fee":0.44000000000005457,"from":"EUR","fromQuantity":439.97071625,"fromValue":439.97,"to":"BTC","toQuantity":0.01019479,"toValue":439.53},{"transactionType":"TRADE","date":"2021-02-18T07:54:33.000Z","fee":0,"from":"BTC","fromQuantity":0.00012636,"fromValue":5.4,"to":"ATOM","toQuantity":0.27,"toValue":5.4},{"transactionType":"TRADE","date":"2021-02-18T07:49:37.000Z","fee":0.4200000000000159,"from":"BTC","fromQuantity":0.0097344,"fromValue":415.75,"to":"ATOM","toQuantity":20.7792,"toValue":415.33},{"transactionType":"TRADE","date":"2021-02-18T07:54:33.000Z","fee":0.01,"from":"BTC","fromQuantity":0.00033228,"fromValue":14.19,"to":"ATOM","toQuantity":0.71,"toValue":14.19},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-19T04:48:31.000Z","fee":0,"from":"EUR","fromQuantity":2.51577829,"fromValue":2.51577829,"to":"BTC","toQuantity":0.000059,"toValue":2.51577829},{"transactionType":"BUY_FROM_DEPOSIT","date":"2021-02-19T04:48:31.000Z","fee":0,"from":"EUR","fromQuantity":127.4945269,"fromValue":127.4945269,"to":"BTC","toQuantity":0.00299,"toValue":127.4945269},{"transactionType":"BUY","date":"2021-02-19T04:53:49.000Z","fee":3.8,"from":"EUR","fromQuantity":196.2,"fromValue":196.2,"to":"BTC","toQuantity":0.004586,"toValue":196.2},{"transactionType":"TRADE","date":"2021-02-16T13:01:58.000Z","fee":0.00004491,"from":"BTC","fromQuantity":0.00039724,"fromValue":16.83,"to":"EASY","toQuantity":0.67,"toValue":16.83},{"transactionType":"TRADE","date":"2021-02-16T13:01:58.000Z","fee":0.00004491,"from":"BTC","fromQuantity":0.00171941,"fromValue":72.86,"to":"EASY","toQuantity":2.9,"toValue":72.86},{"transactionType":"TRADE","date":"2021-02-16T13:01:58.000Z","fee":0.00020044,"from":"BTC","fromQuantity":0.00177307,"fromValue":75.13,"to":"EASY","toQuantity":2.99,"toValue":75.13},{"transactionType":"TRADE","date":"2021-02-16T13:01:58.000Z","fee":0.14999999999997726,"from":"BTC","fromQuantity":0.00354914,"fromValue":150.39,"to":"CAKE","toQuantity":8.935689,"toValue":150.24},{"transactionType":"TRADE","date":"2021-02-16T13:01:58.000Z","fee":0.0000258,"from":"BTC","fromQuantity":0.00019554,"fromValue":8.29,"to":"CAKE","toQuantity":0.49280475,"toValue":8.29},{"transactionType":"TRADE","date":"2021-02-19T07:51:20.000Z","fee":0.10999999999999943,"from":"EASY","fromQuantity":6.56,"fromValue":112.16,"to":"BTC","toQuantity":0.00264431,"toValue":112.05},{"transactionType":"TRADE","date":"2021-02-16T13:01:58.000Z","fee":0.0000258,"from":"CAKE","fromQuantity":9.42,"fromValue":129.09,"to":"BTC","toQuantity":0.00304338,"toValue":128.96},{"transactionType":"BUY","date":"2021-02-19T08:54:50.000Z","fee":5.76,"from":"EUR","fromQuantity":305.708,"fromValue":305.708,"to":"ADA","toQuantity":400,"toValue":314.24},{"transactionType":"TRANSFER","date":"2021-02-16T11:44:09.000Z","fee":0.75,"from":"ADA","fromQuantity":399,"fromValue":305.708,"to":"WALLET","toQuantity":0,"toValue":0},{"transactionType":"TRADE","date":"2021-02-16T13:01:58.000Z","fee":0.23999999999998067,"from":"BTC","fromQuantity":0.00566865,"fromValue":240.2,"to":"ADA","toQuantity":322.677,"toValue":239.96},{"transactionType":"TRANSFER","date":"2021-02-16T11:44:09.000Z","fee":0.75,"from":"ADA","fromQuantity":321.677,"fromValue":240.48,"to":"WALLET","toQuantity":0,"toValue":0}]
    """.trimIndent()))

    result.text = transactions.toStringS()

    add.setOnClickListener {
      transactions.add(
          Transaction(
              transactionType = if (from.stringText() == "EUR") TransactionType.BUY else if (to.stringText() == "EUR") TransactionType.SELL else TransactionType.TRADE,
              date = "Calendar.getInstance().time.time",
              from = from.stringText(),
              fromQuantity = fromQuantity.bigDecimalText(),
              fromValue = fromValue.bigDecimalText(),
              to = to.stringText(),
              toQuantity = toQuantity.bigDecimalText(),
              toValue = toValue.bigDecimalText(),
              fee = fee.bigDecimalText()))

      result.text = transactions.toStringS()
    }

    calculate.setOnClickListener {

      gainz.text = ""

      val tempTransactions = transactions.map { it.copy() }.toMutableList()
      //      tempTransactions.reverse()

      var gainLoss = BigDecimal.ZERO

      transactions.forEachIndexed { index, transaction ->
        when (transaction.transactionType) {

          TransactionType.BUY -> {
            gainz.text = "${gainz.text}-transaction #$index: buy fee: ${-transaction.fee}\n"
            gainLoss += -transaction.fee
          }

          TransactionType.TRADE, TransactionType.SELL, TransactionType.BUY_FROM_DEPOSIT -> {
            var amountToSell = transaction.fromQuantity

            while (amountToSell > BigDecimal.ZERO) {
              tempTransactions.firstOrNull { it.to == transaction.from && it.remainingToQuantity > BigDecimal.ZERO }?.let { boughtCoin ->

                val microTradeAmount = (if (boughtCoin.remainingToQuantity >= amountToSell) amountToSell else boughtCoin.remainingToQuantity)

                val costBase = microTradeAmount * boughtCoin.toValue / boughtCoin.toQuantity

                gainz.text =
                  "${gainz.text}-transaction #$index: ${((microTradeAmount * transaction.fromValue) / transaction.fromQuantity) - costBase} - inc. fee: ${(((microTradeAmount * transaction.fromValue) / transaction.fromQuantity) - costBase - ((microTradeAmount * transaction.fee) / transaction.fromQuantity))}\n"
                gainLoss += (((microTradeAmount * transaction.fromValue) / transaction.fromQuantity) - costBase - ((microTradeAmount * transaction.fee) / transaction.fromQuantity))

                boughtCoin.remainingToQuantity -= microTradeAmount
                amountToSell -= microTradeAmount

              } ?: run {
                amountToSell = BigDecimal.ZERO // missing amounts from binance report - todo
              }
            }
          }

          TransactionType.TRANSFER -> {
            var amountToTransfer = transaction.fromQuantity

            while (amountToTransfer > BigDecimal.ZERO) {
              tempTransactions.first { it.to == transaction.from && it.remainingToQuantity > BigDecimal.ZERO }.let { boughtCoin ->

                val microTradeAmount = (if (boughtCoin.remainingToQuantity >= amountToTransfer) amountToTransfer else boughtCoin.remainingToQuantity)

                boughtCoin.remainingToQuantity -= microTradeAmount
                amountToTransfer -= microTradeAmount
              }

              gainz.text =
                "${gainz.text}-transaction #$index: transfer\n"

            }
          }

          TransactionType.DEPOSIT -> {
              gainz.text =
                  "${gainz.text}-transaction #$index: deposit\n"
          }

        }
      }

      gainz.text = "gainz/losses per transaction \ntotal: $gainLoss \n\n${gainz.text}\ntotal: $gainLoss\n\n"

      tempTransactions.toStringS().log()

      val remainingBalances = mutableMapOf<String, BigDecimal>()
      tempTransactions.forEach {
        remainingBalances[it.to] = (remainingBalances[it.to] ?: BigDecimal.ZERO) + it.remainingToQuantity
      }

      "remaining balances: $remainingBalances".log()
    }
  }
}